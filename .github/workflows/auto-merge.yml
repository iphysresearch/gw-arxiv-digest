name: Auto Merge GW Digest PRs

on:
  schedule:
    - cron: '0 */2 * * *'  # 每2小时检查一次
  workflow_dispatch:  # 支持手动触发

jobs:
  auto-merge:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Auto-merge old GW Digest PRs
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # 查找超过2小时的GW Digest PRs并自动合并
          gh pr list --state open --json number,title,createdAt --jq '.[] | select(.title | startswith("🌊 Daily GW arXiv Digest")) | select((now - (.createdAt | fromdateiso8601)) > 7200) | .number' | \
          while read pr_number; do
            if [ ! -z "$pr_number" ]; then
              echo "🔄 Auto-merging GW Digest PR #$pr_number"
              gh pr merge "$pr_number" --merge --auto || echo "⚠️ Failed to merge PR #$pr_number"
            fi
          done
