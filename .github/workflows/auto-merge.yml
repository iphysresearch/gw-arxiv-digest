name: Auto Merge GW Digest PRs

on:
  schedule:
    - cron: '0 */2 * * *'  # æ¯2å°æ—¶æ£€æŸ¥ä¸€æ¬¡
  workflow_dispatch:  # æ”¯æŒæ‰‹åŠ¨è§¦å‘

jobs:
  auto-merge:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Auto-merge old GW Digest PRs
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # æŸ¥æ‰¾è¶…è¿‡2å°æ—¶çš„GW Digest PRså¹¶è‡ªåŠ¨åˆå¹¶
          gh pr list --state open --json number,title,createdAt --jq '.[] | select(.title | startswith("ğŸŒŠ Daily GW arXiv Digest")) | select((now - (.createdAt | fromdateiso8601)) > 7200) | .number' | \
          while read pr_number; do
            if [ ! -z "$pr_number" ]; then
              echo "ğŸ”„ Auto-merging GW Digest PR #$pr_number"
              gh pr merge "$pr_number" --merge --auto || echo "âš ï¸ Failed to merge PR #$pr_number"
            fi
          done
